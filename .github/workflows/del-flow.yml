name:  Continuous Deployment

on:
  push

jobs:

  build:
    runs-on: windows-latest
    env:
      ProjectUnitTests:   '${{ github.workspace }}\tests\Unity.Tests\Tests.Unit.csproj'
      PackageProjectPath: '${{ github.workspace }}\src\Unity.Container.csproj'
      PackageOutputPath:  '${{ github.workspace }}\package'

    steps:

    - name: Setup local NuGet source
      run: |
        nuget add source "https://nuget.pkg.github.com/unitycontainer/index.json" -n github -u unitycontainer -p ${{secrets.GITHUB_TOKEN}} --store-password-in-clear-text
        nuget setApiKey ${{secrets.GITHUB_TOKEN}}


    - uses: actions/delete-package-versions@v1
      with:
        package-name: 'Unity.Container'
        num-old-versions-to-delete: 10
        token: ${{ secrets.WORKFLOW_PAT }}